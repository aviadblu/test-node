// UI Path Advanced command Playground
// logger json here:
const json = [{
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"instanceaffinity": "1", "processname": "chrome.exe", "title": "Test page"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 244,
        "tabId": -1,
        "tagName": ""
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 246,
        "tabId": 257,
        "tagName": "SELECT"
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "1", "functionCall": "IsHtmlElemValid", "requestId": 248, "tabId": 257}
}, {
    "funcName": "HtmlSelectedItems",
    "params": {
        "codeVersion": 6877,
        "customId": "1",
        "functionCall": "HtmlSelectedItems",
        "getAllItems": 0,
        "itemsToSelect": ["Regular"],
        "requestId": 249,
        "tabId": 257
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"name": "userName"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 251,
        "tabId": 257,
        "tagName": "INPUT"
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "2", "functionCall": "IsHtmlElemValid", "requestId": 253, "tabId": 257}
}, {
    "funcName": "WriteTextHtmlElem",
    "params": {
        "append": 0,
        "codeVersion": 6877,
        "customId": "2",
        "functionCall": "WriteTextHtmlElem",
        "requestId": 254,
        "tabId": 257,
        "text": "Aviad"
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"name": "userPass"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 256,
        "tabId": 257,
        "tagName": "INPUT"
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "3", "functionCall": "IsHtmlElemValid", "requestId": 258, "tabId": 257}
}, {
    "funcName": "WriteTextHtmlElem",
    "params": {
        "append": 0,
        "codeVersion": 6877,
        "customId": "3",
        "functionCall": "WriteTextHtmlElem",
        "requestId": 259,
        "tabId": 257,
        "text": "1234"
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 261,
        "tabId": 257,
        "tagName": "TEXTAREA"
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "4", "functionCall": "IsHtmlElemValid", "requestId": 263, "tabId": 257}
}, {
    "funcName": "WriteTextHtmlElem",
    "params": {
        "append": 0,
        "codeVersion": 6877,
        "customId": "4",
        "functionCall": "WriteTextHtmlElem",
        "requestId": 264,
        "tabId": 257,
        "text": "message test"
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"type": "submit"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 266,
        "tabId": 257,
        "tagName": "INPUT"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 268, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 269, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "5",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 270,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "5", "functionCall": "IsHtmlElemValid", "requestId": 272, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 273, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "5",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 274,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 38,
        "y": 7
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"aaname": "Class selector"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 276,
        "tabId": 257,
        "tagName": "BUTTON"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 278, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 279, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "1",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 280,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "1", "functionCall": "IsHtmlElemValid", "requestId": 282, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 283, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "1",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 284,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 50,
        "y": 8
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"aaname": "No selector"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 286,
        "tabId": 257,
        "tagName": "BUTTON"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 288, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 289, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "2",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 290,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "2", "functionCall": "IsHtmlElemValid", "requestId": 292, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 293, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "2",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 294,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 46,
        "y": 15
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"id": "id-selector"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 296,
        "tabId": 257,
        "tagName": "BUTTON"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 298, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 299, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "3",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 300,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "3", "functionCall": "IsHtmlElemValid", "requestId": 302, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 303, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "3",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 304,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 45,
        "y": 5
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"name": "name-selector"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 306,
        "tabId": 257,
        "tagName": "BUTTON"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 308, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 309, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "4",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 310,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "4", "functionCall": "IsHtmlElemValid", "requestId": 312, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 313, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "4",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 314,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 47,
        "y": 7
    }
}, {
    "funcName": "GetHtmlElemById",
    "params": {
        "attrMap": {"aaname": "Back no selector"},
        "codeVersion": 6877,
        "functionCall": "GetHtmlElemById",
        "index": 1,
        "parentCustomId": "",
        "requestId": 316,
        "tabId": 257,
        "tagName": "A"
    }
}, {
    "funcName": "GetHtmlDevicePixelRatio",
    "params": {"codeVersion": 6877, "functionCall": "GetHtmlDevicePixelRatio", "requestId": 318, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 319, "tabId": 257}
}, {
    "funcName": "GetHtmlRectangle",
    "params": {
        "codeVersion": 6877,
        "customId": "5",
        "functionCall": "GetHtmlRectangle",
        "pageRenderOfsX": 8,
        "pageRenderOfsY": 111,
        "requestId": 320,
        "scrollIntoView": 0,
        "tabId": 257,
        "useClientCoordinates": 0,
        "windowId": 223,
        "windowLeft": -8,
        "windowTop": -8
    }
}, {
    "funcName": "IsHtmlElemValid",
    "params": {"codeVersion": 6877, "customId": "5", "functionCall": "IsHtmlElemValid", "requestId": 322, "tabId": 257}
}, {
    "funcName": "GetWindowIdForTabId",
    "params": {"codeVersion": 6877, "functionCall": "GetWindowIdForTabId", "requestId": 323, "tabId": 257}
}, {
    "funcName": "ClickHtmlElem",
    "params": {
        "codeVersion": 6877,
        "customId": "5",
        "flags": 256,
        "functionCall": "ClickHtmlElem",
        "requestId": 324,
        "tabId": 257,
        "windowLeft": -8,
        "windowTop": -8,
        "x": 15,
        "y": 9
    }
}];

function BreakMilestones(seqJson) {
    let retSteps = [];
    const MilestonesKeys = ["HtmlSelectedItems", "WriteTextHtmlElem", "ClickHtmlElem"];


    let lastBreak = 1;
    let index = 1;
    seqJson.forEach(action => {
        if (MilestonesKeys.indexOf(action.funcName) > -1) {
            retSteps.push(seqJson.slice(lastBreak, index));
            lastBreak = index;
        }
        index++;
    });

    return retSteps;
}

function DOMActions() {
    this.GetHtmlElemById = (params) => {
        const elList = document.getElementsByTagName(params.tagName);
        if (Object.keys(params.attrMap).length === 0) {
            return elList[0];
        }

        let aaname = null;
        if (params.attrMap.hasOwnProperty('aaname')) {
            aaname = params.attrMap.aaname;
            delete params.attrMap.aaname;
        }

        // check if satisfy all conditions
        for (let i = 0; i < elList.length; i++) {
            let el = elList[i];
            if (aaname != null) {
                if (el.innerText === aaname || el.innerHTML === aaname) {
                    return el;
                }
            } else {
                let allCondAligned = true;
                Object.keys(params.attrMap).forEach(attr => {
                    const val = params.attrMap[attr];
                    if (el.getAttribute(attr) !== params.attrMap[attr]) {
                        allCondAligned = false;
                    }
                });
                if (allCondAligned) {
                    return el;
                }
            }
        }
    };

    this.HtmlSelectedItems = (elem, params) => {
        for (let i = 0; i < elem.options.length; i++) {
            elem.options[i].selected = params.itemsToSelect.indexOf(elem.options[i].innerText) >= 0;
        }
    };

    this.WriteTextHtmlElem = (elem, params) => {
        elem.value = params.text;
    };

    this.ClickHtmlElem = (elem, params) => {
        elem.click();
    };
}

function PlaySequenceAction(domm, stepJson) {
    // recognize element
    const elem = domm.GetHtmlElemById(stepJson[0].params);
    const action = stepJson[stepJson.length - 1];
    domm[action.funcName](elem, action.params);
}


const a = BreakMilestones(json);

function CreateAC(json_step) {
    //console.log(json_step);
    const fs = require("fs");

    let retStr = "";

    retStr += DOMActions.toString() + "\n";

    retStr += PlaySequenceAction.toString() + "\n";

    retStr += `PlaySequenceAction(new DOMActions(), JSON.parse('${JSON.stringify(json_step)}'));`;

    fs.writeFile("generated-ac.js", retStr, function (err) {
        if (err) {
            return console.log(err);
        }
        console.log("The file was saved!");
    });

}


//CreateAC(a[4]);







